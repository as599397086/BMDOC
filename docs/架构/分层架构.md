AiSQL 架构遵循分层设计。 逻辑层是 AiSQL 查询层和 CoreDB 分布式文档存储，如下图所示：

![](media/chapter9/13.png)

有关详细信息，请参阅以下内容：
AiSQL 设计目标
文档数据库架构
CoreDB 中的事务
查询层设计
核心功能

**1.AiSQL 查询层**
AiSQL 查询层（BQL）是 AiSQL 的上层。 应用程序使用客户端驱动程序直接与 BQL 交互。 该层处理特定于 API 的方面，例如查询和命令编译，以及运行时（数据类型表示、内置操作等）。 BQL 的设计考虑到了可扩展性，允许添加新的 API。

BQL 支持两种类型的分布式 SQL API：AiSQL SQL (BSQL) 和 AiSQL Cloud QL (BCQL)。

（1）BSQL
BSQL是一个分布式SQL API，是通过复用PostgreSQL语言层代码构建的。 它是一个与 PostgreSQL 有线格式兼容的无状态 SQL 查询引擎。

（2）BCQL
BCQL 是一种半关系语言，源于 Cassandra 查询语言。 它是一种类似 SQL 的语言，专门用于了解跨节点的数据集群。

有关详细信息，请参阅查询层设计。

**2.CoreDB**
CoreDB 是一个分布式文档存储，具有以下属性：

* 写入一致性强
* 对失败具有极高的弹性
* 自动分片和负载均衡
* 可用区、区域和云感知的数据放置策略
* 可调读取一致性

CoreDB 中的数据存储在表中。 每个表由行组成，每行包含一个键和一个document。

（1）分片Sharding
数据存储在 CoreDB 的表内。 CoreDB表通常被分片为多个Tile，这些Tile的分片是透明的。

有关更多信息，请参阅 CoreDB 分片。

（2）复制
每个由用户数据组成的Tile都会使用Raft共识算法根据某个复制因子进行复制。 复制在Tile级别执行，即使在出现故障的情况下也能确保单行线性化。

有关更多信息，请参阅 CoreDB 复制。

（3）持久化
为了持久保存数据，使用了日志结构的行和面向文档的存储。 它包括一些用于有效处理不断增长的数据集的优化。

有关更多信息，请参阅 CoreDB 持久性。

（4）事务
CoreDB 支持单行和多行事务，因此允许修改多个键，同时保留原子性、一致性、隔离性和持久性 (ACID) 属性。

有关详细信息，请参阅以下内容：
CoreDB 隔离级别
单行事务
多行事务
