
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="贝格迈思数据库使用手册">
      
      
      
      
        <link rel="prev" href="Python_Drivers.html">
      
      
        <link rel="next" href="Client_drivers_for_BSQL.html">
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.6">
    
    
      
        <title>Rust Drivers - 手册</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.35e1ed30.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="mo" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      <!--
  Copyright (c) 2016-2024 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Determine classes -->


  


<!-- Header -->
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav
    class="md-header__inner md-grid"
    aria-label="页眉"
  >

    <!-- Link to home -->
    <a
      href="../../index.html"
      title="手册"
      class="md-header__button md-logo"
      aria-label="手册"
      data-md-component="logo"
    >
      
  <img src="../../assets/new-logo.png" alt="logo">

    </a>

    <!-- Button to open drawer -->
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            手册
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Rust Drivers
            
          </span>
        </div>
      </div>
    </div>

    <!-- Color palette toggle -->
    
      
    

    <!-- User preference: color palette -->
    

    <!-- Site language selector -->
    

    <!-- Button to open search modal -->
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>

      <!-- Search interface -->
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    

    <!-- Repository information -->
    
      <div class="md-header__source">
        <a href="https://github.com/as599397086/BMDOC" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>

  <!-- Navigation tabs (sticky) -->
  
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="手册" class="md-nav__button md-logo" aria-label="手册" data-md-component="logo">
      
  <img src="../../assets/new-logo.png" alt="logo">

    </a>
    手册
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/as599397086/BMDOC" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AiSQL简介
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    快速上手
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    应用开发
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            应用开发
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../%E6%9E%84%E5%BB%BA%E5%BA%94%E7%94%A8/JAVA.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    构建应用
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%9E%84%E5%BB%BA%E5%85%A8%E5%B1%80%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    构建全局应用程序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%9E%84%E5%BB%BA%E5%A4%9A%E4%BA%91%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    构建多云应用程序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%B8%B8%E8%A7%81%E6%A8%A1%E5%BC%8F.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常见模式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../%E5%AD%A6%E4%B9%A0%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    学习应用程序开发
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    最佳实践
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../%E9%A9%B1%E5%8A%A8%E4%B8%8E%E5%AF%B9%E8%B1%A1%E5%85%B3%E7%B3%BB%E6%98%A0%E5%B0%84/%E6%A6%82%E8%BF%B0.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    驱动与对象关系映射
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%9C%9F%E5%AE%9E%E7%A4%BA%E4%BE%8B.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    真实示例
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%9C%8D%E5%8A%A1%E8%B4%A8%E9%87%8F.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    服务质量
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../%E4%BA%91%E5%8E%9F%E7%94%9F%E5%BC%80%E5%8F%91.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    云原生开发
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11" checked>
        
          
          <label class="md-nav__link" for="__nav_3_11" id="__nav_3_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    驱动和ORMs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_11_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_11">
            <span class="md-nav__icon md-icon"></span>
            驱动和ORMs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="JDBC_Drivers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JDBC Drivers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="Node.js_Drivers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node.js Drivers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="C%23_Drivers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C# Drivers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="Go_Drivers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Go Drivers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="Python_Drivers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python Drivers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Rust Drivers
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="Rust_Drivers.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Rust Drivers
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    导入驱动程序依赖项
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    基础知识
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    示例
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssltls" class="md-nav__link">
    配置 SSL/TLS
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="Client_drivers_for_BSQL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Client drivers for BSQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="Client_drivers_for_BCQL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Client drivers for BCQL
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC%E4%B8%89%E6%96%B9%E5%B7%A5%E5%85%B7.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第三方工具
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../BSQL%E8%BF%9E%E6%8E%A5%E7%AE%A1%E7%90%86%E6%B1%A0.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BSQL连接管理池
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E9%83%A8%E7%BD%B2%E9%9B%86%E7%BE%A4/%E8%BD%AF%E7%A1%AC%E4%BB%B6%E7%8E%AF%E5%A2%83%E9%9C%80%E6%B1%82.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    部署集群
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../05-%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数据迁移
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93/%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E4%B8%8E%E7%9B%91%E6%8E%A7.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    管理数据库
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../07-%E5%90%91%E9%87%8F%E7%89%B9%E6%80%A7.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    向量特性
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../AI%E7%89%B9%E6%80%A7/%E6%A6%82%E8%BF%B0.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    AI特性
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../%E6%9E%B6%E6%9E%84/%E8%AE%BE%E8%AE%A1%E7%9B%AE%E6%A0%87.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    参考
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    导入驱动程序依赖项
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    基础知识
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    示例
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssltls" class="md-nav__link">
    配置 SSL/TLS
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/as599397086/BMDOC/edit/master/docs/应用开发/驱动和ORMs/Rust_Drivers.md" title="编辑此页" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/as599397086/BMDOC/raw/master/docs/应用开发/驱动和ORMs/Rust_Drivers.md" title="查看本页的源代码" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


  <h1>Rust Drivers</h1>

<p>AiSQL Rust 智能驱动程序是基于 rust-postgres 的 BSQL Rust 驱动程序，具有附加的连接负载平衡功能。
Rust 智能驱动程序提供了两种与 rust-postgres 类似的不同客户端：
* bm-postgres：基于 postgres 的本机同步 AiSQL BSQL 客户端。
* bm-tokio-postgres：基于 tokio-postgres 的本机异步 AiSQL BSQL 客户端.</p>
<h2 id="_1"><strong>导入驱动程序依赖项</strong><a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>您可以通过在 Rust 应用程序的 Cargo.toml 文件中添加以下语句来使用 AiSQL Rust 驱动程序包。
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a># For bm-postgres
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a>bm-postgres = &quot;0.19.7-bm-1-beta&quot;
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a># For bm-tokio-postgres
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a>bm-tokio-postgres = &quot;0.7.10-bm-1-beta&quot;
</span></code></pre></div></td></tr></table></div></p>
<p>或者，从项目目录运行以下命令：
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span>
<span class="normal"><a href="#__codelineno-1-4">4</a></span>
<span class="normal"><a href="#__codelineno-1-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a># For bm-postgres
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a>$ cargo add bm-postgres
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a># For bm-tokio-postgres
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a>$ cargo add bm-tokio-postgres
</span></code></pre></div></td></tr></table></div></p>
<h2 id="_2"><strong>基础知识</strong><a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>了解如何使用 AiSQL Rust 智能驱动程序执行 Rust 应用程序开发所需的常见任务。</p>
<p><strong>1.负载平衡连接属性</strong>
需要添加以下连接属性以启用负载平衡：
* load_balance：通过将此属性设置为 true 来启用集群感知负载平衡； 默认禁用。
* topology_keys：提供以逗号分隔的地理位置值以启用拓扑感知负载平衡。 地理位置可以作为 cloud.region.zone 提供。 将区域中的所有区域指定为 cloud.region.*。 要在主要位置无法访问时指定后备位置，请以 :n 的形式指定优先级，其中 n 是优先顺序。 例如，cloud1.datacenter1.rack1:1、cloud1.datacenter1.rack2:2。</p>
<p>默认情况下，驱动程序每 300 秒（5 分钟）刷新一次节点列表。 您可以通过包含 bm_servers_refresh_interval 参数来更改此值。</p>
<p>以下是 Rust 智能驱动程序提供的其他连接属性：
* Fallback_to_topology_keys_only：当设置为 true 时，智能驱动程序不会尝试连接到 topology_keys 属性指定的主要和后备位置之外的服务器。 默认情况下，驱动程序会回退到集群中的任何可用服务器。 默认为 false。
* failed_host_reconnect_delay_secs：当驱动程序无法连接到服务器时，它使用时间戳标记服务器。 当通过 bm_servers() 刷新服务器列表时，如果响应中出现故障服务器，则仅当服务器被标记为关闭后经过了 failed_host_reconnect_delay_secs 时间后，驱动程序才会将服务器标记为“启动”。 默认值为 5 秒。</p>
<p><strong>2.使用驱动程序</strong>
要使用该驱动程序，请在连接字符串中传递新的连接属性以实现负载平衡。
要在所有服务器之间启用统一负载平衡，请在连接字符串中将 load-balance 属性设置为 true，如下例所示：
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a>let url: String = String::from( &quot;postgresql://localhost:5434/bigmath?user=bigmath&amp;password=bigmath&amp;load_balance=true&quot;, );
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a>let conn = bm_postgres::Client::connect(&amp;connection_url,NoTls,)?;
</span></code></pre></div></td></tr></table></div></p>
<p>您可以在连接字符串中指定多个主机作为后备，以防主地址在初始连接尝试期间失败。 驱动程序建立初始连接后，它会从集群中获取可用服务器列表，并在这些服务器之间平衡后续连接请求。</p>
<p>要指定topology_keys，请将 topology_keys 属性设置为连接字符串或字典中的逗号分隔值，如下例所示：
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a>let url: String = String::from( &quot;postgresql://localhost:5434/bigmath?user=bigmath&amp;password=bigmath&amp;load_balance=true&amp;topology_keys=cloud1.datacenter1.rack2&quot;, );
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a>let conn = bm_postgres::Client::connect(&amp;connection_url,NoTls,)?;
</span></code></pre></div></td></tr></table></div></p>
<h2 id="_3"><strong>示例</strong><a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>本教程展示如何将异步 bm-tokio-postgres 客户端与 AiSQL 结合使用。 首先创建一个复制因子为 3 的三节点集群。本教程使用 bm-ctl 实用程序。</p>
<p>接下来，您使用 Rust 应用程序来演示驱动程序的负载平衡功能。</p>
<p>有关使用同步 bm-postgres 客户端的示例，请参阅连接应用程序。</p>
<p><strong>1.创建本地集群</strong>
创建一个包含 3 节点 RF-3 集群的 Universe，并分配一些虚构的地理位置。 将两个节点放置在一个位置，将第三个节点放置在单独的位置。 使用的放置值只是令牌，与实际的 AWS 云区域和区域无关。
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a>cd &lt;path-to-brightdb-installation&gt;
</span></code></pre></div></td></tr></table></div></p>
<p>要创建多可用区集群，请执行以下操作：
（1）通过运行 bm-ctl start 命令启动第一个节点，传入 --cloud_location 和 --fault_tolerance 标志以设置节点位置详细信息，如下所示：
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a>./bin/bm-ctl start --advertise_address=127.0.0.1 \
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a>    --base_dir=$HOME/bigmath-2.20.1.3/node1 \
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3"></a>    --cloud_location=aws.us-east-1.us-east-1a \
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4"></a>    --fault_tolerance=zone
</span></code></pre></div></td></tr></table></div></p>
<p>（2）使用 --join 标志在两个单独的 VM 上启动第二个和第三个节点，如下所示：
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a>./bin/bm-ctl start --advertise_address=127.0.0.2 \
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a>    --join=127.0.0.1 \
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3"></a>    --base_dir=$HOME/bigmath-2.20.1.3/node2 \
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4"></a>    --cloud_location=aws.us-east-1.us-east-1a \
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5"></a>    --fault_tolerance=zone
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6"></a>./bin/bm-ctl start --advertise_address=127.0.0.3 \
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7"></a>    --join=127.0.0.1 \
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8"></a>    --base_dir=$HOME/bigmath-2.20.1.3/node3 \
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9"></a>    --cloud_location=aws.us-east-1.us-east-1b \
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10"></a>    --fault_tolerance=zone
</span></code></pre></div></td></tr></table></div></p>
<p><strong>2.检查均匀负载平衡</strong>
要检查均匀负载平衡，请执行以下操作：</p>
<p>（1）使用以下命令创建 Rust 项目：
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a>cargo new try-it-out
</span></code></pre></div></td></tr></table></div></p>
<p>这将创建项目“try-it-out”，其中包含 Cargo.toml 文件（项目元数据）和包含主代码文件 main.rs 的 src 目录。</p>
<p>（2）在 Cargo.toml 文件中添加 bm-tokio-postgres = "0.7.10-bm-1-beta" 依赖项，如下所示：
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span>
<span class="normal"><a href="#__codelineno-8-7">7</a></span>
<span class="normal"><a href="#__codelineno-8-8">8</a></span>
<span class="normal"><a href="#__codelineno-8-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a>[package]
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2"></a>name = &quot;try-it-out&quot;
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3"></a>version = &quot;0.1.0&quot;
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4"></a>edition = &quot;2021&quot;
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5"></a>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6"></a># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7"></a>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8"></a>[dependencies]
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9"></a>bm-tokio-postgres = &quot;0.7.10-bm-1-beta&quot;
</span></code></pre></div></td></tr></table></div></p>
<p>（3）将文件 src/main.rs 中的现有代码替换为以下代码：
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span>
<span class="normal"><a href="#__codelineno-9-16">16</a></span>
<span class="normal"><a href="#__codelineno-9-17">17</a></span>
<span class="normal"><a href="#__codelineno-9-18">18</a></span>
<span class="normal"><a href="#__codelineno-9-19">19</a></span>
<span class="normal"><a href="#__codelineno-9-20">20</a></span>
<span class="normal"><a href="#__codelineno-9-21">21</a></span>
<span class="normal"><a href="#__codelineno-9-22">22</a></span>
<span class="normal"><a href="#__codelineno-9-23">23</a></span>
<span class="normal"><a href="#__codelineno-9-24">24</a></span>
<span class="normal"><a href="#__codelineno-9-25">25</a></span>
<span class="normal"><a href="#__codelineno-9-26">26</a></span>
<span class="normal"><a href="#__codelineno-9-27">27</a></span>
<span class="normal"><a href="#__codelineno-9-28">28</a></span>
<span class="normal"><a href="#__codelineno-9-29">29</a></span>
<span class="normal"><a href="#__codelineno-9-30">30</a></span>
<span class="normal"><a href="#__codelineno-9-31">31</a></span>
<span class="normal"><a href="#__codelineno-9-32">32</a></span>
<span class="normal"><a href="#__codelineno-9-33">33</a></span>
<span class="normal"><a href="#__codelineno-9-34">34</a></span>
<span class="normal"><a href="#__codelineno-9-35">35</a></span>
<span class="normal"><a href="#__codelineno-9-36">36</a></span>
<span class="normal"><a href="#__codelineno-9-37">37</a></span>
<span class="normal"><a href="#__codelineno-9-38">38</a></span>
<span class="normal"><a href="#__codelineno-9-39">39</a></span>
<span class="normal"><a href="#__codelineno-9-40">40</a></span>
<span class="normal"><a href="#__codelineno-9-41">41</a></span>
<span class="normal"><a href="#__codelineno-9-42">42</a></span>
<span class="normal"><a href="#__codelineno-9-43">43</a></span>
<span class="normal"><a href="#__codelineno-9-44">44</a></span>
<span class="normal"><a href="#__codelineno-9-45">45</a></span>
<span class="normal"><a href="#__codelineno-9-46">46</a></span>
<span class="normal"><a href="#__codelineno-9-47">47</a></span>
<span class="normal"><a href="#__codelineno-9-48">48</a></span>
<span class="normal"><a href="#__codelineno-9-49">49</a></span>
<span class="normal"><a href="#__codelineno-9-50">50</a></span>
<span class="normal"><a href="#__codelineno-9-51">51</a></span>
<span class="normal"><a href="#__codelineno-9-52">52</a></span>
<span class="normal"><a href="#__codelineno-9-53">53</a></span>
<span class="normal"><a href="#__codelineno-9-54">54</a></span>
<span class="normal"><a href="#__codelineno-9-55">55</a></span>
<span class="normal"><a href="#__codelineno-9-56">56</a></span>
<span class="normal"><a href="#__codelineno-9-57">57</a></span>
<span class="normal"><a href="#__codelineno-9-58">58</a></span>
<span class="normal"><a href="#__codelineno-9-59">59</a></span>
<span class="normal"><a href="#__codelineno-9-60">60</a></span>
<span class="normal"><a href="#__codelineno-9-61">61</a></span>
<span class="normal"><a href="#__codelineno-9-62">62</a></span>
<span class="normal"><a href="#__codelineno-9-63">63</a></span>
<span class="normal"><a href="#__codelineno-9-64">64</a></span>
<span class="normal"><a href="#__codelineno-9-65">65</a></span>
<span class="normal"><a href="#__codelineno-9-66">66</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a>use isahc::ReadResponseExt;
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2"></a>use tokio::task::JoinHandle;
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3"></a>use bm_tokio_postgres::{Client, Error, NoTls};
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4"></a>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5"></a>#[tokio::main]
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6"></a>async fn main() -&gt; Result&lt;(), Error&gt; {
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7"></a>   println!(&quot;Starting the example ...&quot;);
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8"></a>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9"></a>   let url: String = String::from(
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10"></a>   &quot;postgresql://127.0.0.1:2521/bigmath?user=bigmath&amp;password=bigmath&amp;load_balance=true&quot;,
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11"></a>   );
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12"></a>   println!(&quot;Using connection url: {}&quot;, url);
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13"></a>   let (_clients, _connections) = createconn(30, url).await.unwrap();
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14"></a>   //Check and print number of connections on each node.
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15"></a>   num_of_connections();
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16"></a>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17"></a>   println!(&quot;End of Example&quot;);
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18"></a>   Ok(())
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19"></a>}
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20"></a>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21"></a>async fn createconn(
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22"></a>   numconn: usize,
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23"></a>   url: String,
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24"></a>) -&gt; Result&lt;(Vec&lt;Client&gt;, Vec&lt;JoinHandle&lt;()&gt;&gt;), Error&gt; {
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25"></a>   let mut connectionstored: Vec&lt;JoinHandle&lt;()&gt;&gt; = Vec::with_capacity(numconn);
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26"></a>   let mut clientstored: Vec&lt;Client&gt; = Vec::with_capacity(numconn);
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27"></a>   for _i in 0..numconn {
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28"></a>       let connectionresult = createconnection(url.clone()).await;
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29"></a>       match connectionresult {
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30"></a>          Err(error) =&gt; return Err(error),
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31"></a>          Ok((connection, client)) =&gt; {
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32"></a>              clientstored.push(client);
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33"></a>              connectionstored.push(connection);
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34"></a>          }
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35"></a>       }
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36"></a>   }
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37"></a>   return Ok((clientstored, connectionstored));
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38"></a>}
</span><span id="__span-9-39"><a id="__codelineno-9-39" name="__codelineno-9-39"></a>
</span><span id="__span-9-40"><a id="__codelineno-9-40" name="__codelineno-9-40"></a>async fn createconnection(url: String) -&gt; Result&lt;(tokio::task::JoinHandle&lt;()&gt;, Client), Error&gt; {
</span><span id="__span-9-41"><a id="__codelineno-9-41" name="__codelineno-9-41"></a>   let (client, connection) = bm_tokio_postgres::connect(&amp;url, NoTls).await?;
</span><span id="__span-9-42"><a id="__codelineno-9-42" name="__codelineno-9-42"></a>
</span><span id="__span-9-43"><a id="__codelineno-9-43" name="__codelineno-9-43"></a>   // The connection object performs the actual communication with the database,
</span><span id="__span-9-44"><a id="__codelineno-9-44" name="__codelineno-9-44"></a>   // so spawn it off to run on its own.
</span><span id="__span-9-45"><a id="__codelineno-9-45" name="__codelineno-9-45"></a>   let handle = tokio::spawn(async move {
</span><span id="__span-9-46"><a id="__codelineno-9-46" name="__codelineno-9-46"></a>       if let Err(e) = connection.await {
</span><span id="__span-9-47"><a id="__codelineno-9-47" name="__codelineno-9-47"></a>           eprintln!(&quot;connection error: {}&quot;, e);
</span><span id="__span-9-48"><a id="__codelineno-9-48" name="__codelineno-9-48"></a>       }
</span><span id="__span-9-49"><a id="__codelineno-9-49" name="__codelineno-9-49"></a>   });
</span><span id="__span-9-50"><a id="__codelineno-9-50" name="__codelineno-9-50"></a>
</span><span id="__span-9-51"><a id="__codelineno-9-51" name="__codelineno-9-51"></a>   Ok((handle, client))
</span><span id="__span-9-52"><a id="__codelineno-9-52" name="__codelineno-9-52"></a>}
</span><span id="__span-9-53"><a id="__codelineno-9-53" name="__codelineno-9-53"></a>
</span><span id="__span-9-54"><a id="__codelineno-9-54" name="__codelineno-9-54"></a>pub(crate) fn num_of_connections() {
</span><span id="__span-9-55"><a id="__codelineno-9-55" name="__codelineno-9-55"></a>   for i in 1..4 {
</span><span id="__span-9-56"><a id="__codelineno-9-56" name="__codelineno-9-56"></a>       let url = &quot;http://127.0.0.&quot;.to_owned() + &amp;i.to_string() + &quot;:8100/rpcz&quot;;
</span><span id="__span-9-57"><a id="__codelineno-9-57" name="__codelineno-9-57"></a>       let response = isahc::get(url);
</span><span id="__span-9-58"><a id="__codelineno-9-58" name="__codelineno-9-58"></a>       if response.is_err() {
</span><span id="__span-9-59"><a id="__codelineno-9-59" name="__codelineno-9-59"></a>           println!(&quot;127.0.0.{} = {}&quot;,i, 0);
</span><span id="__span-9-60"><a id="__codelineno-9-60" name="__codelineno-9-60"></a>       } else {
</span><span id="__span-9-61"><a id="__codelineno-9-61" name="__codelineno-9-61"></a>           let body = response.unwrap().text().unwrap();
</span><span id="__span-9-62"><a id="__codelineno-9-62" name="__codelineno-9-62"></a>           let c = body.matches(&quot;client backend&quot;).count();
</span><span id="__span-9-63"><a id="__codelineno-9-63" name="__codelineno-9-63"></a>           println!(&quot;127.0.0.{} = {}&quot;, i, c);
</span><span id="__span-9-64"><a id="__codelineno-9-64" name="__codelineno-9-64"></a>       }
</span><span id="__span-9-65"><a id="__codelineno-9-65" name="__codelineno-9-65"></a>   }
</span><span id="__span-9-66"><a id="__codelineno-9-66" name="__codelineno-9-66"></a>}
</span></code></pre></div></td></tr></table></div></p>
<p>（4）运行示例：
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a>cargo run
</span></code></pre></div></td></tr></table></div></p>
<p>该应用程序创建 30 个连接并显示一个键值对映射，其中键是主机，值是主机上的连接数。 （应用程序从每个节点的 http://<host>:8100/rpcz 获取连接数。此 URL 提供一个连接列表，其中列表的每个元素都有一些有关连接的信息。）每个节点应有 10 个 连接。</p>
<p><strong>3.检查拓扑感知负载平衡</strong>
对于拓扑感知负载平衡，请运行应用程序并将 topology_keys 属性设置为 aws.us-east-1.us-east-1a。 本例中仅使用两个节点。</p>
<p>将 src/main.rs 中的现有代码替换为以下示例代码：
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span>
<span class="normal"><a href="#__codelineno-11-18">18</a></span>
<span class="normal"><a href="#__codelineno-11-19">19</a></span>
<span class="normal"><a href="#__codelineno-11-20">20</a></span>
<span class="normal"><a href="#__codelineno-11-21">21</a></span>
<span class="normal"><a href="#__codelineno-11-22">22</a></span>
<span class="normal"><a href="#__codelineno-11-23">23</a></span>
<span class="normal"><a href="#__codelineno-11-24">24</a></span>
<span class="normal"><a href="#__codelineno-11-25">25</a></span>
<span class="normal"><a href="#__codelineno-11-26">26</a></span>
<span class="normal"><a href="#__codelineno-11-27">27</a></span>
<span class="normal"><a href="#__codelineno-11-28">28</a></span>
<span class="normal"><a href="#__codelineno-11-29">29</a></span>
<span class="normal"><a href="#__codelineno-11-30">30</a></span>
<span class="normal"><a href="#__codelineno-11-31">31</a></span>
<span class="normal"><a href="#__codelineno-11-32">32</a></span>
<span class="normal"><a href="#__codelineno-11-33">33</a></span>
<span class="normal"><a href="#__codelineno-11-34">34</a></span>
<span class="normal"><a href="#__codelineno-11-35">35</a></span>
<span class="normal"><a href="#__codelineno-11-36">36</a></span>
<span class="normal"><a href="#__codelineno-11-37">37</a></span>
<span class="normal"><a href="#__codelineno-11-38">38</a></span>
<span class="normal"><a href="#__codelineno-11-39">39</a></span>
<span class="normal"><a href="#__codelineno-11-40">40</a></span>
<span class="normal"><a href="#__codelineno-11-41">41</a></span>
<span class="normal"><a href="#__codelineno-11-42">42</a></span>
<span class="normal"><a href="#__codelineno-11-43">43</a></span>
<span class="normal"><a href="#__codelineno-11-44">44</a></span>
<span class="normal"><a href="#__codelineno-11-45">45</a></span>
<span class="normal"><a href="#__codelineno-11-46">46</a></span>
<span class="normal"><a href="#__codelineno-11-47">47</a></span>
<span class="normal"><a href="#__codelineno-11-48">48</a></span>
<span class="normal"><a href="#__codelineno-11-49">49</a></span>
<span class="normal"><a href="#__codelineno-11-50">50</a></span>
<span class="normal"><a href="#__codelineno-11-51">51</a></span>
<span class="normal"><a href="#__codelineno-11-52">52</a></span>
<span class="normal"><a href="#__codelineno-11-53">53</a></span>
<span class="normal"><a href="#__codelineno-11-54">54</a></span>
<span class="normal"><a href="#__codelineno-11-55">55</a></span>
<span class="normal"><a href="#__codelineno-11-56">56</a></span>
<span class="normal"><a href="#__codelineno-11-57">57</a></span>
<span class="normal"><a href="#__codelineno-11-58">58</a></span>
<span class="normal"><a href="#__codelineno-11-59">59</a></span>
<span class="normal"><a href="#__codelineno-11-60">60</a></span>
<span class="normal"><a href="#__codelineno-11-61">61</a></span>
<span class="normal"><a href="#__codelineno-11-62">62</a></span>
<span class="normal"><a href="#__codelineno-11-63">63</a></span>
<span class="normal"><a href="#__codelineno-11-64">64</a></span>
<span class="normal"><a href="#__codelineno-11-65">65</a></span>
<span class="normal"><a href="#__codelineno-11-66">66</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a>use isahc::ReadResponseExt;
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2"></a>use tokio::task::JoinHandle;
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3"></a>use bm_tokio_postgres::{Client, Error, NoTls};
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4"></a>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5"></a>#[tokio::main]
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6"></a>async fn main() -&gt; Result&lt;(), Error&gt; {
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7"></a>   println!(&quot;Starting the example ...&quot;);
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8"></a>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9"></a>   let url: String = String::from(
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10"></a>       &quot;postgresql://127.0.0.1:2521/bigmath?user=bigmath&amp;password=bigmath&amp;load_balance=true&amp;topology_keys=aws.us-east-1.us-east-1a&quot;,
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11"></a>   );
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12"></a>   println!(&quot;Using connection url: {}&quot;, url);
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13"></a>   let (_clients, _connections) = createconn(30, url).await.unwrap();
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14"></a>   //Check and print number of connections on each node.
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15"></a>   num_of_connections();
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16"></a>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17"></a>   println!(&quot;End of Example&quot;);
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18"></a>   Ok(())
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19"></a>}
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20"></a>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21"></a>async fn createconn(
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22"></a>   numconn: usize,
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23"></a>   url: String,
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24"></a>) -&gt; Result&lt;(Vec&lt;Client&gt;, Vec&lt;JoinHandle&lt;()&gt;&gt;), Error&gt; {
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25"></a>   let mut connectionstored: Vec&lt;JoinHandle&lt;()&gt;&gt; = Vec::with_capacity(numconn);
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26"></a>   let mut clientstored: Vec&lt;Client&gt; = Vec::with_capacity(numconn);
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27"></a>   for _i in 0..numconn {
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28"></a>       let connectionresult = createconnection(url.clone()).await;
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29"></a>       match connectionresult {
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30"></a>           Err(error) =&gt; return Err(error),
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31"></a>           Ok((connection, client)) =&gt; {
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32"></a>               clientstored.push(client);
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33"></a>               connectionstored.push(connection);
</span><span id="__span-11-34"><a id="__codelineno-11-34" name="__codelineno-11-34"></a>           }
</span><span id="__span-11-35"><a id="__codelineno-11-35" name="__codelineno-11-35"></a>       }
</span><span id="__span-11-36"><a id="__codelineno-11-36" name="__codelineno-11-36"></a>   }
</span><span id="__span-11-37"><a id="__codelineno-11-37" name="__codelineno-11-37"></a>   return Ok((clientstored, connectionstored));
</span><span id="__span-11-38"><a id="__codelineno-11-38" name="__codelineno-11-38"></a>}
</span><span id="__span-11-39"><a id="__codelineno-11-39" name="__codelineno-11-39"></a>
</span><span id="__span-11-40"><a id="__codelineno-11-40" name="__codelineno-11-40"></a>async fn createconnection(url: String) -&gt; Result&lt;(tokio::task::JoinHandle&lt;()&gt;, Client), Error&gt; {
</span><span id="__span-11-41"><a id="__codelineno-11-41" name="__codelineno-11-41"></a>   let (client, connection) = bm_tokio_postgres::connect(&amp;url, NoTls).await?;
</span><span id="__span-11-42"><a id="__codelineno-11-42" name="__codelineno-11-42"></a>
</span><span id="__span-11-43"><a id="__codelineno-11-43" name="__codelineno-11-43"></a>   // The connection object performs the actual communication with the database,
</span><span id="__span-11-44"><a id="__codelineno-11-44" name="__codelineno-11-44"></a>   // so spawn it off to run on its own.
</span><span id="__span-11-45"><a id="__codelineno-11-45" name="__codelineno-11-45"></a>   let handle = tokio::spawn(async move {
</span><span id="__span-11-46"><a id="__codelineno-11-46" name="__codelineno-11-46"></a>       if let Err(e) = connection.await {
</span><span id="__span-11-47"><a id="__codelineno-11-47" name="__codelineno-11-47"></a>           eprintln!(&quot;connection error: {}&quot;, e);
</span><span id="__span-11-48"><a id="__codelineno-11-48" name="__codelineno-11-48"></a>       }
</span><span id="__span-11-49"><a id="__codelineno-11-49" name="__codelineno-11-49"></a>   });
</span><span id="__span-11-50"><a id="__codelineno-11-50" name="__codelineno-11-50"></a>
</span><span id="__span-11-51"><a id="__codelineno-11-51" name="__codelineno-11-51"></a>   Ok((handle, client))
</span><span id="__span-11-52"><a id="__codelineno-11-52" name="__codelineno-11-52"></a>}
</span><span id="__span-11-53"><a id="__codelineno-11-53" name="__codelineno-11-53"></a>
</span><span id="__span-11-54"><a id="__codelineno-11-54" name="__codelineno-11-54"></a>pub(crate) fn num_of_connections() {
</span><span id="__span-11-55"><a id="__codelineno-11-55" name="__codelineno-11-55"></a>   for i in 1..4 {
</span><span id="__span-11-56"><a id="__codelineno-11-56" name="__codelineno-11-56"></a>       let url = &quot;http://127.0.0.&quot;.to_owned() + &amp;i.to_string() + &quot;:8100/rpcz&quot;;
</span><span id="__span-11-57"><a id="__codelineno-11-57" name="__codelineno-11-57"></a>       let response = isahc::get(url);
</span><span id="__span-11-58"><a id="__codelineno-11-58" name="__codelineno-11-58"></a>       if response.is_err() {
</span><span id="__span-11-59"><a id="__codelineno-11-59" name="__codelineno-11-59"></a>           println!(&quot;127.0.0.{} = {}&quot;,i, 0);
</span><span id="__span-11-60"><a id="__codelineno-11-60" name="__codelineno-11-60"></a>       } else {
</span><span id="__span-11-61"><a id="__codelineno-11-61" name="__codelineno-11-61"></a>           let body = response.unwrap().text().unwrap();
</span><span id="__span-11-62"><a id="__codelineno-11-62" name="__codelineno-11-62"></a>           let c = body.matches(&quot;client backend&quot;).count();
</span><span id="__span-11-63"><a id="__codelineno-11-63" name="__codelineno-11-63"></a>           println!(&quot;127.0.0.{} = {}&quot;, i, c);
</span><span id="__span-11-64"><a id="__codelineno-11-64" name="__codelineno-11-64"></a>       }
</span><span id="__span-11-65"><a id="__codelineno-11-65" name="__codelineno-11-65"></a>   }
</span><span id="__span-11-66"><a id="__codelineno-11-66" name="__codelineno-11-66"></a>}
</span></code></pre></div></td></tr></table></div></p>
<p>在这种情况下，前两个节点应各有 15 个连接，第三个节点应有 0 个连接。</p>
<p><strong>4.清理</strong>
完成实验后，运行以下命令来销毁本地集群：
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a>./bin/bm-ctl destroy --base_dir=$HOME/bigmath-2.20.1.3/node1
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2"></a>./bin/bm-ctl destroy --base_dir=$HOME/bigmath-2.20.1.3/node2
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3"></a>./bin/bm-ctl destroy --base_dir=$HOME/bigmath-2.20.1.3/node3
</span></code></pre></div></td></tr></table></div></p>
<h2 id="ssltls"><strong>配置 SSL/TLS</strong><a class="headerlink" href="#ssltls" title="Permanent link">&para;</a></h2>
<p>AiSQL Rust 智能驱动程序对 SSL 的支持与上游驱动程序相同。</p>
<p>下表描述了使用 SSL 时 AiSQL Rust 智能驱动程序需要作为连接字符串一部分的附加参数。
| 参数    | 描述    | 默认值 |
| ------- | ------- | ------ |
| Sslmode | SSL模式 | prefer |</p>
<p>rust-postgres 驱动程序支持以下 SSL 模式。
disable：不使用 TLS。
prefer (default)：如果可用，请使用 TLS，否则不使用。
Require：需要使用 TLS。</p>
<p>目前，rust-postgres 驱动程序和 AiSQL Rust 智能驱动程序不支持 verify-full 或 verify-ca SSL 模式。</p>
<p>AiSQL Managed 需要 SSL/TLS，使用 SSL 模式禁用的连接将失败。</p>
<p>以下是连接到启用了 SSL 加密的 AiSQL 集群的示例连接 URL：
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1"></a>&quot;postgresql://127.0.0.1:5434/bigmath?user=bigmath&amp;password=bigmath&amp;load_balance=true&amp;sslmode=require&quot;
</span></code></pre></div></td></tr></table></div></p>
<p>如果您在 AiSQL Managed 上创建了集群，请使用集群凭据并下载 SSL 根证书。</p>
<p>以下是连接到启用了 SSL 的 AiSQL 集群的示例应用程序：</p>
<p>执行前在 Cargo.toml 文件中添加 bm-postgres-openssl = "0.5.0-bm-1"、bm-postgres = "0.19.7-bm-1-beta" 和 openssl = "0.10.61" 依赖项 应用程序。
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span>
<span class="normal"><a href="#__codelineno-14-16">16</a></span>
<span class="normal"><a href="#__codelineno-14-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a>use openssl::ssl::{SslConnector, SslMethod};
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2"></a>use bm_postgres_openssl::MakeTlsConnector;
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3"></a>use bm_postgres::{Client};
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4"></a>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5"></a>fn main()  {
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6"></a>   let mut builder = SslConnector::builder(SslMethod::tls()).expect(&quot;unable to create sslconnector builder&quot;);
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7"></a>   builder.set_ca_file(&quot;/path/to/root/certificate&quot;).expect(&quot;unable to load root certificate&quot;);
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8"></a>   let connector: MakeTlsConnector = MakeTlsConnector::new(builder.build());
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9"></a>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10"></a>   let mut connection = Client::connect( &quot;host=? port=2521 dbname=bigmath user=? password=? sslmode=require&quot;,
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11"></a>       connector,
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12"></a>       ).expect(&quot;failed to create tls bsql connection&quot;);
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13"></a>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14"></a>   let result = connection.query_one(&quot;select 1&quot;, &amp;[]).expect(&quot;failed to execute select 1 bsql&quot;);
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15"></a>   let value: i32 = result.get(0);
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16"></a>   println!(&quot;result of query_one call: {}&quot;, value);
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17"></a>}
</span></code></pre></div></td></tr></table></div></p>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="Python_Drivers.html" class="md-footer__link md-footer__link--prev" aria-label="上一页: Python Drivers">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                Python Drivers
              </div>
            </div>
          </a>
        
        
          
          <a href="Client_drivers_for_BSQL.html" class="md-footer__link md-footer__link--next" aria-label="下一页: Client drivers for BSQL">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                Client drivers for BSQL
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2023 - 2024 贝格迈思（深圳）技术有限公司 粤ICP备17054434号-1
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/as599397086/BMDOC" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.prune", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.aecac24b.min.js"></script>
      
        <script src="../../javascripts/extra.js"></script>
      
    
  </body>
</html>