
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="贝格迈思数据库使用手册">
      
      
      
      
        <link rel="prev" href="PLpgSQL%E4%B8%AD%E7%9A%84%E6%95%B0%E7%BB%84%E5%BE%AA%E7%8E%AF.html">
      
      
        <link rel="next" href="%E6%95%B0%E7%BB%84%E5%87%BD%E6%95%B0%E5%92%8C%E8%BF%90%E7%AE%97%E7%AC%A6.html">
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.6">
    
    
      
        <title>使用DOMAIN值数组 - 手册</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.35e1ed30.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="mo" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gps" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      <!--
  Copyright (c) 2016-2024 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Determine classes -->


  


<!-- Header -->
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav
    class="md-header__inner md-grid"
    aria-label="页眉"
  >

    <!-- Link to home -->
    <a
      href="../../index.html"
      title="手册"
      class="md-header__button md-logo"
      aria-label="手册"
      data-md-component="logo"
    >
      
  <img src="../../assets/new-logo.png" alt="logo">

    </a>

    <!-- Button to open drawer -->
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            手册
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              使用DOMAIN值数组
            
          </span>
        </div>
      </div>
    </div>

    <!-- Color palette toggle -->
    
      
    

    <!-- User preference: color palette -->
    

    <!-- Site language selector -->
    

    <!-- Button to open search modal -->
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>

      <!-- Search interface -->
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    

    <!-- Repository information -->
    
      <div class="md-header__source">
        <a href="https://github.com/as599397086/BMDOC" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>

  <!-- Navigation tabs (sticky) -->
  
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="手册" class="md-nav__button md-logo" aria-label="手册" data-md-component="logo">
      
  <img src="../../assets/new-logo.png" alt="logo">

    </a>
    手册
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/as599397086/BMDOC" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AiSQL简介
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    快速上手
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/%E6%9E%84%E5%BB%BA%E5%BA%94%E7%94%A8/JAVA.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    应用开发
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E9%83%A8%E7%BD%B2%E9%9B%86%E7%BE%A4/%E8%BD%AF%E7%A1%AC%E4%BB%B6%E7%8E%AF%E5%A2%83%E9%9C%80%E6%B1%82.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    部署集群
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../05-%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数据迁移
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93/%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E4%B8%8E%E7%9B%91%E6%8E%A7.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    管理数据库
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../07-%E5%90%91%E9%87%8F%E7%89%B9%E6%80%A7.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    向量特性
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../AI%E7%89%B9%E6%80%A7/%E6%A6%82%E8%BF%B0.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    AI特性
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" checked>
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    参考
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            参考
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E6%9E%B6%E6%9E%84/%E8%AE%BE%E8%AE%A1%E7%9B%AE%E6%A0%87.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    架构
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../CLIs/sqlsh/%E6%A6%82%E8%BF%B0.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    CLIs
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E9%85%8D%E7%BD%AE/bm-mserver.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    配置
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_4" checked>
        
          
          <label class="md-nav__link" for="__nav_9_4" id="__nav_9_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    BSQL
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9_4">
            <span class="md-nav__icon md-icon"></span>
            BSQL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_4_1" checked>
        
          
          <label class="md-nav__link" for="__nav_9_4_1" id="__nav_9_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    数据类型
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_9_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9_4_1">
            <span class="md-nav__icon md-icon"></span>
            数据类型
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="%E6%95%B0%E7%BB%84.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数组
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="PLpgSQL%E4%B8%AD%E7%9A%84%E6%95%B0%E7%BB%84%E5%BE%AA%E7%8E%AF.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PL/pgSQL中的数组循环
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    使用DOMAIN值数组
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="%E4%BD%BF%E7%94%A8DOMAIN%E5%80%BC%E6%95%B0%E7%BB%84.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    使用DOMAIN值数组
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gps" class="md-nav__link">
    示例：GPS行程数据
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    创建不规则数组
  </a>
  
    <nav class="md-nav" aria-label="创建不规则数组">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    矛盾
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    解决方案
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    处理数组的不规则数组
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foreachdomains" class="md-nav__link">
    将FOREACH与DOMAINs数组结合使用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#array_aggdomain" class="md-nav__link">
    使用array_agg()生成DOMAIN值数组
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    创建矩阵
  </a>
  
    <nav class="md-nav" aria-label="创建矩阵">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    定义需要的数据类型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#block_matrix_tdomain" class="md-nav__link">
    使用“block_matrix_t”DOMAIN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unnest" class="md-nav__link">
    对数组使用unnest()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="%E6%95%B0%E7%BB%84%E5%87%BD%E6%95%B0%E5%92%8C%E8%BF%90%E7%AE%97%E7%AC%A6.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数组函数和运算符
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="Binary.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binary
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="Boolean.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Boolean
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="Character.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Character
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="date%E4%B8%8Etime.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    date与time
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="json.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    json
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="Money.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Money
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="%E6%95%B0%E5%AD%97%E7%B1%BB%E5%9E%8B.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数字类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="%E8%8C%83%E5%9B%B4%E7%B1%BB%E5%9E%8B.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    范围类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="Serial.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="UUID.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UUID
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    枚举类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="%E5%87%A0%E4%BD%95%E7%B1%BB%E5%9E%8B.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    几何类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E7%B1%BB%E5%9E%8B.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    网络地址类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="%E4%BD%8D%E4%B8%B2%E7%B1%BB%E5%9E%8B.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    位串类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="%E6%96%87%E6%9C%AC%E6%90%9C%E7%B4%A2%E7%B1%BB%E5%9E%8B.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    文本搜索类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="%E5%9F%9F%E7%B1%BB%E5%9E%8B.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    域类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="%E4%BC%AA%E7%B1%BB%E5%9E%8B.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    伪类型
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../BSQL%E8%AF%AD%E8%A8%80.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BSQL语言
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0%E5%92%8C%E8%BF%90%E7%AE%97%E7%AC%A6/%E9%80%BB%E8%BE%91%E6%93%8D%E4%BD%9C%E7%AC%A6.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    内置函数和运算符
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%85%B3%E9%94%AE%E8%AF%8D.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    关键词
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../%E4%BF%9D%E7%95%99%E5%90%8D%E7%A7%B0.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    保留名称
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%B3%BB%E7%BB%9F%E8%A1%A8%E8%A7%86%E5%9B%BE.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    系统表/视图
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../BCQL/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    BCQL
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gps" class="md-nav__link">
    示例：GPS行程数据
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    创建不规则数组
  </a>
  
    <nav class="md-nav" aria-label="创建不规则数组">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    矛盾
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    解决方案
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    处理数组的不规则数组
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foreachdomains" class="md-nav__link">
    将FOREACH与DOMAINs数组结合使用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#array_aggdomain" class="md-nav__link">
    使用array_agg()生成DOMAIN值数组
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    创建矩阵
  </a>
  
    <nav class="md-nav" aria-label="创建矩阵">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    定义需要的数据类型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#block_matrix_tdomain" class="md-nav__link">
    使用“block_matrix_t”DOMAIN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unnest" class="md-nav__link">
    对数组使用unnest()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/as599397086/BMDOC/edit/master/docs/BSQL/数据类型/使用DOMAIN值数组.md" title="编辑此页" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/as599397086/BMDOC/raw/master/docs/BSQL/数据类型/使用DOMAIN值数组.md" title="查看本页的源代码" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


  <h1>使用DOMAIN值数组</h1>

<p>DOMAIN值的数组可以创建一个一维数组，其值本身就是不同长度的一维数组。概括地说，它允许您实现一个不规则的多维数组，从而打破了数组通常必须是线性化的限制。</p>
<h2 id="gps"><strong>示例：GPS行程数据</strong><a class="headerlink" href="#gps" title="Permanent link">&para;</a></h2>
<p>在某些用例中，不规则的结构是必不可少的。因此，大多数编程语言都会支持这一特性。
下面来查看此示例：GPS行程数据。考虑GPS的行程，其记录被分解为圈，因此：</p>
<ul>
<li>每次行程由一圈，或多圈组成。</li>
<li>每圈通常由大量的GPS数据点组成。 </li>
</ul>
<p>以下的实现可以达到期望： </p>
<ul>
<li>每个圈都被表示为“圈”表中的一行，该表含有作为GPS数据点数组实现的多值字段。</li>
<li>但每一次行程都由“行程”表中的一行代表，该行的圈数是“圈数”表中的某一子行。这个父子关系通常由外键约束来支持。但请注意，每圈的GPS点的数量可能与其他圈的点的数量不相同。</li>
</ul>
<p>接下来，下一个目标，是通过将整个行程表示为“行程”表中的一个不规则数组，而省去了单独的“圈数”表。该方案要求能够将行程表示为“GPS数据点数组”数据类型。换句话说，这取决于创建此类命名数据类型的能力，而DOMAIN 具有此种能力。</p>
<h2 id="_1"><strong>创建不规则数组</strong><a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h3 id="_2">矛盾<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>乍一看，定义表列、PL/pgSQL变量或形式参数的语法似乎存在阻碍目标实现的矛盾。例如，这个PL/pgSQL声明显然将“v”定义为一维数组。</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a>declare v int[];
</span></code></pre></div></td></tr></table></div>
<p>然而，这个可执行部分首先将一个二维数组值（大小为三乘三）分配给“v”，将数组的每个值初始化为17。然后，它将三维数组值（大小为2乘2乘2）分配给“v”，将数组的每个值初始化为42：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span>
<span class="normal"><a href="#__codelineno-1-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a>    begin
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a>    v := array_fill(17, &#39;{3, 3}&#39;);
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a>    ...
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a>    v := array_fill(42, &#39;{2, 2, 2}&#39;);
</span></code></pre></div></td></tr></table></div>
<p>数组数据类型和功能中指出了数组变量声明的属性，即它无法修复随后分配给该变量的值的维度。表中具有数组数据类型的列共享此属性，以便该列可以在不同的行中容纳不同维度的数组。这与以下“v1”和“v2”的声明虽然明显不同，但定义了相同的语义这一事实密切相关。</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a>declare
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a>  v1 int[];
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a>  v2 int[][];
</span></code></pre></div></td></tr></table></div>
<p>这种句法上的怪癖恰恰说明了这个矛盾。“v2”是二维数组，还是int[]类型的数组？答案是两者都不是。相反，它是一个任意维度的数组。</p>
<p>那么如何编写数组的声明，你可能会猜测这会起作用：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a>declare
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a>  v (int[])[];
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a>But this causes a compilation error. The paradox is exactly that int[] is anonymou
</span></code></pre></div></td></tr></table></div>
<p>但这会导致编译错误。矛盾之处恰恰在于int[]是匿名的。</p>
<h3 id="_3">解决方案<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>DOMAIN带来了打破限制的功能。首先，请执行以下操作：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a>set client_min_messages = warning;
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a>drop domain if exists int_arr_t cascade;
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a>create domain int_arr_t as int[];
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4"></a>create table t(k serial primary key, v1 int_arr_t[], typecast text, v2 int_arr_t[]);
</span></code></pre></div></td></tr></table></div>
<p>请注意，CREATE DOMAIN语句的使用是类型构造的一个示例。用户定义的数据类型“int_arr_t”就是这种构造的数据类型的一个示例。</p>
<p>列“v1”和“v2”现在可以存储数组的不规则数组。如下证明：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span>
<span class="normal"><a href="#__codelineno-5-5">5</a></span>
<span class="normal"><a href="#__codelineno-5-6">6</a></span>
<span class="normal"><a href="#__codelineno-5-7">7</a></span>
<span class="normal"><a href="#__codelineno-5-8">8</a></span>
<span class="normal"><a href="#__codelineno-5-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a>do $body$
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a>declare
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3"></a>  arr_1      constant int_arr_t := array[1, 2];
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4"></a>  arr_2      constant int_arr_t := array[3, 4, 5];
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5"></a>  ragged_arr constant int_arr_t[] := array[arr_1, arr_2];
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6"></a>begin
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7"></a>  insert into t(v1) values(ragged_arr);
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8"></a>end;
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9"></a>$body$;
</span></code></pre></div></td></tr></table></div>
<p>通过使用DO块，通过自下而上构建来设置“ragged_arr”的值，可以强调它实际上是一个由不同长度的一维数组组成的一维数组。那么，它显然不是一个二维线性化数组。</p>
<p>现在使用<a href="#_值到文本的类型转换和返回值">值到文本的类型转换和返回值</a>解释的技术来检查不规则数组的::text类型转换，通过类型转换转换回原始数据类型的值。首先，请执行以下操作： </p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span>
<span class="normal"><a href="#__codelineno-6-4">4</a></span>
<span class="normal"><a href="#__codelineno-6-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a>update t
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a>set typecast = v1::text
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3"></a>where k = 1;
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5"></a>select typecast from t where k = 1;
</span></code></pre></div></td></tr></table></div>
<p>返回信息如下：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a>      typecast
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a>---------------------
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a> {&quot;{1,2}&quot;,&quot;{3,4,5}&quot;}
</span></code></pre></div></td></tr></table></div>
<p>接下来：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a>update t
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2"></a>set v2 = typecast::int_arr_t[]
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3"></a>where k = 1;
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4"></a>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5"></a>select (v1 = v2)::text as &quot;v1 = v2&quot; from t where k = 1;
</span></code></pre></div></td></tr></table></div>
<p>返回信息如下：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a> v1 = v2 
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2"></a>---------
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3"></a> true
</span></code></pre></div></td></tr></table></div>
<p>已重新创建原始值。</p>
<h3 id="_4">处理数组的不规则数组<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>首先，考虑这个反例：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span>
<span class="normal"><a href="#__codelineno-10-6">6</a></span>
<span class="normal"><a href="#__codelineno-10-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a>\pset null &#39;&lt;IS NULL&#39;&gt;
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a>with v as (
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a>  select  &#39;{{1,2},{3,4}}&#39;::int[] as two_d_arr)
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a>select
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5"></a>  two_d_arr[2][1] as &quot;[2][1] -- meaningful&quot;,
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6"></a>  two_d_arr[2]    as    &quot;[2] -- meaningless&quot;
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7"></a>from v;
</span></code></pre></div></td></tr></table></div>
<p>返回信息如下：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span>
<span class="normal"><a href="#__codelineno-11-2">2</a></span>
<span class="normal"><a href="#__codelineno-11-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a> [2][1] -- meaningful | [2] -- meaningless
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2"></a>----------------------+--------------------
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3"></a>                3 |     &lt;IS NULL&gt;
</span></code></pre></div></td></tr></table></div>
<p>如何处理线性多维数组中的单个值？可以使用以下通用方案：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a>[idx_1][idx_2]...[idx_n]
</span></code></pre></div></td></tr></table></div>
<p>必须提供与数组的维数完全相同的索引值。此外，如果您做错了，并且提供了太多或太少的索引值，那么您不会看到错误，而是得到值NULL。在此，一个显而易见的问题是： 
如何寻址？例如，如何寻址数组中的第一个值，而该值本身就是数组的不规则数组中的第二个数组？</p>
<p>在输入之前，您知道这不可能是正确的：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1"></a>select v1[2][1] as &quot;v1[2][1]&quot; from t where k = 1;
</span></code></pre></div></td></tr></table></div>
<p>返回信息如下：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a> v1[2][1]
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2"></a>-----------
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3"></a> &lt;IS NULL&gt;
</span></code></pre></div></td></tr></table></div>
<p>不会出错，但也得不到想要的。请尝试以下操作： </p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a>select v1[2] as &quot;v1[2]&quot; from t where k = 1;
</span></code></pre></div></td></tr></table></div>
<p>返回信息如下：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1"></a>  v1[2]
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2"></a>---------
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3"></a> {3,4,5}
</span></code></pre></div></td></tr></table></div>
<p>您已经在数组的数组中标识了想要的叶数组。现在您必须在该数组中标识所需的值。试试这个：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1"></a>select (v1[2])[1] as &quot;(v1[2])[1]&quot; from t where k = 1;
</span></code></pre></div></td></tr></table></div>
<p>返回信息如下：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1"></a> (v1[2])[1]
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2"></a>------------
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3"></a>          3
</span></code></pre></div></td></tr></table></div>
<p>同样，您可以如下检查叶数组的几何属性，如下所示：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span>
<span class="normal"><a href="#__codelineno-19-4">4</a></span>
<span class="normal"><a href="#__codelineno-19-5">5</a></span>
<span class="normal"><a href="#__codelineno-19-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1"></a>select
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2"></a>  array_lower(v1[1], 1) as v1_lb,
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3"></a>  array_upper(v1[1], 1) as v1_ub,
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4"></a>  array_lower(v1[2], 1) as v2_lb,
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5"></a>  array_upper(v1[2], 1) as v2_ub
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6"></a>from t where k = 1;
</span></code></pre></div></td></tr></table></div>
<p>返回信息如下：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span>
<span class="normal"><a href="#__codelineno-20-2">2</a></span>
<span class="normal"><a href="#__codelineno-20-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1"></a> v1_lb | v1_ub | v2_lb | v2_ub
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2"></a>-------+-------+-------+-------
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3"></a>     1 |    2 |    1 |    3
</span></code></pre></div></td></tr></table></div>
<p>最后，试试这个反例：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span>
<span class="normal"><a href="#__codelineno-21-3">3</a></span>
<span class="normal"><a href="#__codelineno-21-4">4</a></span>
<span class="normal"><a href="#__codelineno-21-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1"></a>with v as (
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2"></a>  select  &#39;{{1,2},{3,4}}&#39;::int[] as two_d_arr)
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3"></a>select
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4"></a>  (two_d_arr[2])[1]
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5"></a>from v;
</span></code></pre></div></td></tr></table></div>
<p>它会导致SQL编译错误。您必须知道，要在其中寻址值的当前值是线性化多维数组，还是不规则的数组的数组。</p>
<h3 id="foreachdomains">将FOREACH与DOMAINs数组结合使用<a class="headerlink" href="#foreachdomains" title="Permanent link">&para;</a></h3>
<p>这个示例解释说明了这个问题。</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span>
<span class="normal"><a href="#__codelineno-22-18">18</a></span>
<span class="normal"><a href="#__codelineno-22-19">19</a></span>
<span class="normal"><a href="#__codelineno-22-20">20</a></span>
<span class="normal"><a href="#__codelineno-22-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1"></a>set client_min_messages = warning;
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2"></a>drop domain if exists array_t cascade;
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3"></a>drop domain if exists arrays_t cascade;
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4"></a>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5"></a>create domain array_t  as int[];
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6"></a>create domain arrays_t as array_t[];
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7"></a>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8"></a>\set VERBOSITY verbose
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9"></a>do $body$
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10"></a>declare
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11"></a>  arrays arrays_t := array[
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12"></a>    array[1, 2]::array_t, array[3, 4, 5]::array_t];
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13"></a>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14"></a>  runner array_t not null := &#39;{}&#39;;
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15"></a>begin
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16"></a>  -- Error 42804 here.
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17"></a>  foreach runner in array arrays loop
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18"></a>    raise info &#39;%&#39;, runner::text;
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19"></a>  end loop;
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20"></a>end;
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21"></a>$body$;
</span></code></pre></div></td></tr></table></div>
<p>引发如下错误：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1"></a>ERROR:  42804: FOREACH expression must yield an array, not type arrays_t
</span></code></pre></div></td></tr></table></div>
<p>错误文本可能会使您感到困惑。实际上，这意味着循环头中ARRAY关键字的参数必须是一个显式数组，而不是为这样的数组命名的domain 。 </p>
<p>一个简单的解决方法是将“arrays”显式声明为“array_t[]”，而不是使用“array_t”作为简写。如下所示：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1"></a>\set VERBOSITY default
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2"></a>do $body$
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3"></a>declare
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4"></a>  arrays array_t[] := array[
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5"></a>    array[1, 2]::array_t, array[3, 4, 5]::array_t];
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6"></a>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7"></a>  runner array_t not null := &#39;{}&#39;;
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8"></a>begin
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9"></a>  foreach runner in array arrays loop
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10"></a>    raise info &#39;%&#39;, runner::text;
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11"></a>  end loop;
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12"></a>end;
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13"></a>$body$;
</span></code></pre></div></td></tr></table></div>
<p>返回信息如下：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1"></a>INFO:  {1,2}
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2"></a>INFO:  {3,4,5}
</span></code></pre></div></td></tr></table></div>
<p>如果真的需要使用DOMAIN怎么办？例如，您可能希望定义这样的约束：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span>
<span class="normal"><a href="#__codelineno-26-2">2</a></span>
<span class="normal"><a href="#__codelineno-26-3">3</a></span>
<span class="normal"><a href="#__codelineno-26-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1"></a>set client_min_messages = warning;
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2"></a>drop domain if exists arrays_t cascade;
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3"></a>create domain arrays_t as array_t[]
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4"></a>check ((cardinality(value) = 2));
</span></code></pre></div></td></tr></table></div>
<p>解决方法是：将ARRAY关键字的参数类型转换为适当元素数据类型的数组。 </p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-27-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-27-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-27-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-27-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-27-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-27-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-27-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-27-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-27-10">10</a></span>
<span class="normal"><a href="#__codelineno-27-11">11</a></span>
<span class="normal"><a href="#__codelineno-27-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1"></a>do $body$
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2"></a>declare
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3"></a>  arrays arrays_t := array[
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4"></a>    array[1, 2]::array_t, array[3, 4, 5]::array_t];
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5"></a>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6"></a>  runner array_t not null := &#39;{}&#39;;
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7"></a>begin
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8"></a>  foreach runner in array arrays::array_t[] loop
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9"></a>    raise info &#39;%&#39;, runner::text;
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10"></a>  end loop;
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11"></a>end;
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12"></a>$body$;
</span></code></pre></div></td></tr></table></div>
<p>返回信息如下：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1"></a>INFO:  {1,2}
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2"></a>INFO:  {3,4,5}
</span></code></pre></div></td></tr></table></div>
<h3 id="array_aggdomain">使用array_agg()生成DOMAIN值数组<a class="headerlink" href="#array_aggdomain" title="Permanent link">&para;</a></h3>
<p>事实证明，不支持直接聚合表示不规则数组的DOMAIN值。但是一个简单的PL/pgSQL函数提供了解决方法。</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-29-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-29-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-29-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-29-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-29-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-29-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-29-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-29-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-29-10">10</a></span>
<span class="normal"><a href="#__codelineno-29-11">11</a></span>
<span class="normal"><a href="#__codelineno-29-12">12</a></span>
<span class="normal"><a href="#__codelineno-29-13">13</a></span>
<span class="normal"><a href="#__codelineno-29-14">14</a></span>
<span class="normal"><a href="#__codelineno-29-15">15</a></span>
<span class="normal"><a href="#__codelineno-29-16">16</a></span>
<span class="normal"><a href="#__codelineno-29-17">17</a></span>
<span class="normal"><a href="#__codelineno-29-18">18</a></span>
<span class="normal"><a href="#__codelineno-29-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1"></a>set client_min_messages = warning;
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2"></a>drop table if exists t cascade;
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3"></a>drop domain if exists array_t cascade;
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4"></a>drop domain if exists arrays_t cascade;
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5"></a>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6"></a>create domain array_t  as int[];
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7"></a>create domain arrays_t as array_t[];
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8"></a>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9"></a>create table t(k serial primary key, v array_t);
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10"></a>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11"></a>insert into t(v) values
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12"></a>  (&#39;{2,6}&#39;),
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13"></a>  (&#39;{1,4,5,6}&#39;),
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14"></a>  (&#39;{4,5}&#39;),
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15"></a>  (&#39;{2,3}&#39;),
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16"></a>  (&#39;{4,5}&#39;),
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17"></a>  (&#39;{3,5,7}&#39;);
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18"></a>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19"></a>select v from t order by k;
</span></code></pre></div></td></tr></table></div>
<p>返回信息如下：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span>
<span class="normal"><a href="#__codelineno-30-3">3</a></span>
<span class="normal"><a href="#__codelineno-30-4">4</a></span>
<span class="normal"><a href="#__codelineno-30-5">5</a></span>
<span class="normal"><a href="#__codelineno-30-6">6</a></span>
<span class="normal"><a href="#__codelineno-30-7">7</a></span>
<span class="normal"><a href="#__codelineno-30-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1"></a>     v
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2"></a>-----------
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3"></a> {2,6}
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4"></a> {1,4,5,6}
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5"></a> {4,5}
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6"></a> {2,3}
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7"></a> {4,5}
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8"></a> {3,5,7}
</span></code></pre></div></td></tr></table></div>
<p>如下说明了问题：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span>
<span class="normal"><a href="#__codelineno-31-2">2</a></span>
<span class="normal"><a href="#__codelineno-31-3">3</a></span>
<span class="normal"><a href="#__codelineno-31-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1"></a>\set VERBOSITY verbose
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2"></a>select
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3"></a>  array_agg(v order by k)
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4"></a>from t;
</span></code></pre></div></td></tr></table></div>
<p>会返回如下错误信息：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1"></a>2202E: cannot accumulate arrays of different dimensionality
</span></code></pre></div></td></tr></table></div>
<p>类型转换不能生效，但此函数会产生所需的结果：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-33-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-33-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-33-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-33-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-33-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-33-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-33-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-33-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-33-10">10</a></span>
<span class="normal"><a href="#__codelineno-33-11">11</a></span>
<span class="normal"><a href="#__codelineno-33-12">12</a></span>
<span class="normal"><a href="#__codelineno-33-13">13</a></span>
<span class="normal"><a href="#__codelineno-33-14">14</a></span>
<span class="normal"><a href="#__codelineno-33-15">15</a></span>
<span class="normal"><a href="#__codelineno-33-16">16</a></span>
<span class="normal"><a href="#__codelineno-33-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1"></a>\set VERBOSITY default
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2"></a>create or replace function array_agg_v()
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3"></a>  returns arrays_t
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4"></a>  language plpgsql
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5"></a>as $body$
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6"></a>&lt;&lt;b&gt;&gt;declare
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7"></a>  v  array_t    not null := &#39;{}&#39;;
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8"></a>  n  int        not null := 0;
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9"></a>  r  array_t[]  not null := &#39;{}&#39;;
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10"></a>begin
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11"></a>  for b.v in (select t.v from t order by k) loop
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12"></a>    n := n + 1;
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13"></a>    r[n] := b.v;
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14"></a>  end loop;
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15"></a>  return r;
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16"></a>end b;
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17"></a>$body$;
</span></code></pre></div></td></tr></table></div>
<p>执行：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1"></a>select array_agg_v();
</span></code></pre></div></td></tr></table></div>
<p>返回信息如下：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span>
<span class="normal"><a href="#__codelineno-35-2">2</a></span>
<span class="normal"><a href="#__codelineno-35-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1"></a>                       array_agg_v
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2"></a>------------------------------------------------------------------------
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3"></a> {&quot;{2,6}&quot;,&quot;{1,4,5,6}&quot;,&quot;{4,5}&quot;,&quot;{2,3}&quot;,&quot;{4,5}&quot;,&quot;{3,5,7}&quot;}
</span></code></pre></div></td></tr></table></div>
<h2 id="_5"><strong>创建矩阵</strong><a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p>数学、物理学等领域的各种学科都使用块矩阵。数组的使用说明了这种情况如何在客户端程序中生成各种数组，以及以后需要在客户端程序中将这些值再次使用。在当前用例中，这带来了持久化和检索块矩阵的需求。
尽管这个用例相对来说比较奇特，但用于实现所需结构的技术（尤其是可行解决方案对用户定义的DOMAIN数据类型的依赖性）具有通用性。正是由于这个原因，这里解释了这种方法。</p>
<h3 id="_6">定义需要的数据类型<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>首先，定义“有效负载”矩阵的数据类型。假设需要执行以下规则：</p>
<ul>
<li>有效负载矩阵在原子上不能为null。</li>
<li>根据定义，它必须是二维的。</li>
<li>一定是三乘三。</li>
<li>每个维度的下限必须为1。</li>
<li>矩阵的每个值都不能是NULL。</li>
</ul>
<p>DOMAIN类型构造函数的要求是，它必须允许在构造类型的值上定义任意约束，如下所示：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span>
<span class="normal"><a href="#__codelineno-36-13">13</a></span>
<span class="normal"><a href="#__codelineno-36-14">14</a></span>
<span class="normal"><a href="#__codelineno-36-15">15</a></span>
<span class="normal"><a href="#__codelineno-36-16">16</a></span>
<span class="normal"><a href="#__codelineno-36-17">17</a></span>
<span class="normal"><a href="#__codelineno-36-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1"></a>create domain matrix_t as text[]
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2"></a>check (
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3"></a>  (value is not null)         and
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4"></a>  (array_ndims(value) = 2)    and
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5"></a>  (array_lower(value, 1) = 1) and
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6"></a>  (array_lower(value, 2) = 1) and
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7"></a>  (array_upper(value, 1) = 3) and
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8"></a>  (array_upper(value, 2) = 3) and
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9"></a>  (value[1][1] is not null  ) and
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10"></a>  (value[1][2] is not null  ) and
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11"></a>  (value[1][3] is not null  ) and
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12"></a>  (value[2][1] is not null  ) and
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13"></a>  (value[2][2] is not null  ) and
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14"></a>  (value[2][3] is not null  ) and
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15"></a>  (value[3][1] is not null  ) and
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16"></a>  (value[3][2] is not null  ) and
</span><span id="__span-36-17"><a id="__codelineno-36-17" name="__codelineno-36-17"></a>  (value[3][3] is not null  )
</span><span id="__span-36-18"><a id="__codelineno-36-18" name="__codelineno-36-18"></a>);
</span></code></pre></div></td></tr></table></div>
<p>接下来，定义一个“matrix_t”的块矩阵。假设需要执行类似的以下规则：</p>
<ul>
<li>块矩阵在原子上不能为null。</li>
<li>根据定义，它必须是二维的。</li>
<li>一定是二乘二。</li>
<li>每个维度的下限必须为1。</li>
<li>矩阵的每个值都必须不是NULL。 </li>
</ul>
<p>因此，“block_matrix_t”的CREATE DOMAIN语句，与“matrix_t”的语句类似：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-37-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-37-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-37-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-37-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-37-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-37-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-37-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-37-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-37-10">10</a></span>
<span class="normal"><a href="#__codelineno-37-11">11</a></span>
<span class="normal"><a href="#__codelineno-37-12">12</a></span>
<span class="normal"><a href="#__codelineno-37-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1"></a>create domain block_matrix_t as matrix_t[]
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2"></a>check (
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3"></a>  (value is not null)         and
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4"></a>  (array_ndims(value) = 2)    and
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5"></a>  (array_lower(value, 1) = 1) and
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6"></a>  (array_lower(value, 2) = 1) and
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7"></a>  (array_upper(value, 1) = 2) and
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8"></a>  (array_upper(value, 2) = 2) and
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9"></a>  (value[1][1] is not null  ) and
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10"></a>  (value[1][2] is not null  ) and
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11"></a>  (value[2][1] is not null  ) and
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12"></a>  (value[2][2] is not null  )
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13"></a>);
</span></code></pre></div></td></tr></table></div>
<p>这两个CREATE DOMAIN语句冗长而重复，但它们足以说明该方法的基础。为了在实际应用程序中使用，最好将所有CHECK规则封装在PL/pgSQL函数中，该函数以DOMAIN值为输入并返回布尔值，并将其用作单个CHECK谓词。该函数可以使用array_lower（）和array_length（）函数来计算两个嵌套FOR循环的范围，以检查数组的各个值是否都满足NOT NULL规则。</p>
<h3 id="block_matrix_tdomain">使用“block_matrix_t”DOMAIN<a class="headerlink" href="#block_matrix_tdomain" title="Permanent link">&para;</a></h3>
<p>接下来，创建一个块矩阵值，将其及其 ::text 类型转换插入到表中，并检查类型转换的值。</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-38-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-38-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-38-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-38-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-38-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-38-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-38-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-38-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-38-10">10</a></span>
<span class="normal"><a href="#__codelineno-38-11">11</a></span>
<span class="normal"><a href="#__codelineno-38-12">12</a></span>
<span class="normal"><a href="#__codelineno-38-13">13</a></span>
<span class="normal"><a href="#__codelineno-38-14">14</a></span>
<span class="normal"><a href="#__codelineno-38-15">15</a></span>
<span class="normal"><a href="#__codelineno-38-16">16</a></span>
<span class="normal"><a href="#__codelineno-38-17">17</a></span>
<span class="normal"><a href="#__codelineno-38-18">18</a></span>
<span class="normal"><a href="#__codelineno-38-19">19</a></span>
<span class="normal"><a href="#__codelineno-38-20">20</a></span>
<span class="normal"><a href="#__codelineno-38-21">21</a></span>
<span class="normal"><a href="#__codelineno-38-22">22</a></span>
<span class="normal"><a href="#__codelineno-38-23">23</a></span>
<span class="normal"><a href="#__codelineno-38-24">24</a></span>
<span class="normal"><a href="#__codelineno-38-25">25</a></span>
<span class="normal"><a href="#__codelineno-38-26">26</a></span>
<span class="normal"><a href="#__codelineno-38-27">27</a></span>
<span class="normal"><a href="#__codelineno-38-28">28</a></span>
<span class="normal"><a href="#__codelineno-38-29">29</a></span>
<span class="normal"><a href="#__codelineno-38-30">30</a></span>
<span class="normal"><a href="#__codelineno-38-31">31</a></span>
<span class="normal"><a href="#__codelineno-38-32">32</a></span>
<span class="normal"><a href="#__codelineno-38-33">33</a></span>
<span class="normal"><a href="#__codelineno-38-34">34</a></span>
<span class="normal"><a href="#__codelineno-38-35">35</a></span>
<span class="normal"><a href="#__codelineno-38-36">36</a></span>
<span class="normal"><a href="#__codelineno-38-37">37</a></span>
<span class="normal"><a href="#__codelineno-38-38">38</a></span>
<span class="normal"><a href="#__codelineno-38-39">39</a></span>
<span class="normal"><a href="#__codelineno-38-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1"></a>create table block_matrices_1(k int primary key, v block_matrix_t, text_typecast text);
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2"></a>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3"></a>do $body$
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4"></a>declare
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5"></a>  -- The definitions of the two domains imply &quot;not null&quot; constraints
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6"></a>  -- on each of the variables &quot;matrix_t&quot; and &quot;block_matrix_t&quot;.
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7"></a>  m matrix_t       := array_fill(&#39;00&#39;::text, array[3, 3], array[1, 1]);
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8"></a>  b block_matrix_t := array_fill(m,          array[2, 2], array[1, 1]);
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9"></a>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10"></a>  n int not null := 0;
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11"></a>  ms matrix_t[];
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12"></a>begin
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13"></a>  -- Define four matrix_t values so that, for readability of the result,
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14"></a>  -- the in-total 24 values are taken from an increasing dense series.
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15"></a>  for i in 1..4 loop
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16"></a>    for j in 1..3 loop
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17"></a>      for k in 1..3 loop
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18"></a>        n := n + 1;
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19"></a>        m[j][k] := ltrim(to_char(n, &#39;09&#39;));
</span><span id="__span-38-20"><a id="__codelineno-38-20" name="__codelineno-38-20"></a>      end loop;
</span><span id="__span-38-21"><a id="__codelineno-38-21" name="__codelineno-38-21"></a>    end loop;
</span><span id="__span-38-22"><a id="__codelineno-38-22" name="__codelineno-38-22"></a>    ms[i] := m;
</span><span id="__span-38-23"><a id="__codelineno-38-23" name="__codelineno-38-23"></a>  end loop;
</span><span id="__span-38-24"><a id="__codelineno-38-24" name="__codelineno-38-24"></a>
</span><span id="__span-38-25"><a id="__codelineno-38-25" name="__codelineno-38-25"></a>  n := 0;
</span><span id="__span-38-26"><a id="__codelineno-38-26" name="__codelineno-38-26"></a>  for j in 1..2 loop
</span><span id="__span-38-27"><a id="__codelineno-38-27" name="__codelineno-38-27"></a>    for k in 1..2 loop
</span><span id="__span-38-28"><a id="__codelineno-38-28" name="__codelineno-38-28"></a>      n := n + 1;
</span><span id="__span-38-29"><a id="__codelineno-38-29" name="__codelineno-38-29"></a>      b[j][k] := ms[n];
</span><span id="__span-38-30"><a id="__codelineno-38-30" name="__codelineno-38-30"></a>    end loop;
</span><span id="__span-38-31"><a id="__codelineno-38-31" name="__codelineno-38-31"></a>  end loop;
</span><span id="__span-38-32"><a id="__codelineno-38-32" name="__codelineno-38-32"></a>
</span><span id="__span-38-33"><a id="__codelineno-38-33" name="__codelineno-38-33"></a>  insert into block_matrices_1(k, v, text_typecast)
</span><span id="__span-38-34"><a id="__codelineno-38-34" name="__codelineno-38-34"></a>  values(1, b, b::text);
</span><span id="__span-38-35"><a id="__codelineno-38-35" name="__codelineno-38-35"></a>end;
</span><span id="__span-38-36"><a id="__codelineno-38-36" name="__codelineno-38-36"></a>$body$;
</span><span id="__span-38-37"><a id="__codelineno-38-37" name="__codelineno-38-37"></a>
</span><span id="__span-38-38"><a id="__codelineno-38-38" name="__codelineno-38-38"></a>select text_typecast
</span><span id="__span-38-39"><a id="__codelineno-38-39" name="__codelineno-38-39"></a>from block_matrices_1
</span><span id="__span-38-40"><a id="__codelineno-38-40" name="__codelineno-38-40"></a>where k = 1;
</span></code></pre></div></td></tr></table></div>
<p>返回信息如下（为方便阅读，手动增加了空格）：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-39-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-39-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-39-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-39-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-39-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-39-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-39-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-39-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-39-10">10</a></span>
<span class="normal"><a href="#__codelineno-39-11">11</a></span>
<span class="normal"><a href="#__codelineno-39-12">12</a></span>
<span class="normal"><a href="#__codelineno-39-13">13</a></span>
<span class="normal"><a href="#__codelineno-39-14">14</a></span>
<span class="normal"><a href="#__codelineno-39-15">15</a></span>
<span class="normal"><a href="#__codelineno-39-16">16</a></span>
<span class="normal"><a href="#__codelineno-39-17">17</a></span>
<span class="normal"><a href="#__codelineno-39-18">18</a></span>
<span class="normal"><a href="#__codelineno-39-19">19</a></span>
<span class="normal"><a href="#__codelineno-39-20">20</a></span>
<span class="normal"><a href="#__codelineno-39-21">21</a></span>
<span class="normal"><a href="#__codelineno-39-22">22</a></span>
<span class="normal"><a href="#__codelineno-39-23">23</a></span>
<span class="normal"><a href="#__codelineno-39-24">24</a></span>
<span class="normal"><a href="#__codelineno-39-25">25</a></span>
<span class="normal"><a href="#__codelineno-39-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1"></a>{
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2"></a>  {
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3"></a>    &quot;{
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4"></a>      {01,02,03},     block_matrix[1][1]
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5"></a>      {04,05,06},
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6"></a>      {07,08,09}
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7"></a>    }&quot;,
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8"></a>    &quot;{
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9"></a>      {10,11,12},     block_matrix[1][2]
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10"></a>      {13,14,15},
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11"></a>      {16,17,18}
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12"></a>    }&quot;
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13"></a>  },
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14"></a>  {
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15"></a>    &quot;{
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16"></a>      {19,20,21},     block_matrix[2][1]
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17"></a>      {22,23,24},
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18"></a>      {25,26,27}
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19"></a>    }&quot;,
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20"></a>    &quot;{
</span><span id="__span-39-21"><a id="__codelineno-39-21" name="__codelineno-39-21"></a>      {28,29,30},     block_matrix[2][2]
</span><span id="__span-39-22"><a id="__codelineno-39-22" name="__codelineno-39-22"></a>      {31,32,33},
</span><span id="__span-39-23"><a id="__codelineno-39-23" name="__codelineno-39-23"></a>      {34,35,36}
</span><span id="__span-39-24"><a id="__codelineno-39-24" name="__codelineno-39-24"></a>    }&quot;
</span><span id="__span-39-25"><a id="__codelineno-39-25" name="__codelineno-39-25"></a>  }
</span><span id="__span-39-26"><a id="__codelineno-39-26" name="__codelineno-39-26"></a>}
</span></code></pre></div></td></tr></table></div>
<p>注意：注释“block_matrix”等等这些信息是手动添加的，只是为了突出显示整个文本值的含义。</p>
<p>最后，检查一下结构是否符合通用规则：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-40-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-40-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-40-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-40-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-40-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-40-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-40-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-40-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-40-10">10</a></span>
<span class="normal"><a href="#__codelineno-40-11">11</a></span>
<span class="normal"><a href="#__codelineno-40-12">12</a></span>
<span class="normal"><a href="#__codelineno-40-13">13</a></span>
<span class="normal"><a href="#__codelineno-40-14">14</a></span>
<span class="normal"><a href="#__codelineno-40-15">15</a></span>
<span class="normal"><a href="#__codelineno-40-16">16</a></span>
<span class="normal"><a href="#__codelineno-40-17">17</a></span>
<span class="normal"><a href="#__codelineno-40-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1"></a>create table block_matrices_2(k int primary key, v block_matrix_t);
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2"></a>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3"></a>insert into block_matrices_2(k, v)
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4"></a>select k, text_typecast::block_matrix_t
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5"></a>from block_matrices_1
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6"></a>where k = 1;
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7"></a>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8"></a>with a as (
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9"></a>  select k, t1.v as v1, t2.v as v2
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10"></a>  from
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11"></a>  block_matrices_1 as t1
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12"></a>  inner join
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13"></a>  block_matrices_2 as t2
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14"></a>  using (k)
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15"></a>  )
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16"></a>select (v1 = v2)::text as &quot;v1 = v2&quot;
</span><span id="__span-40-17"><a id="__codelineno-40-17" name="__codelineno-40-17"></a>from a
</span><span id="__span-40-18"><a id="__codelineno-40-18" name="__codelineno-40-18"></a>where k = 1;
</span></code></pre></div></td></tr></table></div>
<p>返回信息如下：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1">1</a></span>
<span class="normal"><a href="#__codelineno-41-2">2</a></span>
<span class="normal"><a href="#__codelineno-41-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1"></a> v1 = v2
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2"></a>---------
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3"></a> true
</span></code></pre></div></td></tr></table></div>
<h3 id="unnest">对数组使用unnest()<a class="headerlink" href="#unnest" title="Permanent link">&para;</a></h3>
<p>首先，按行主要顺序生成“matrix_t”值列表：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">1</a></span>
<span class="normal"><a href="#__codelineno-42-2">2</a></span>
<span class="normal"><a href="#__codelineno-42-3">3</a></span>
<span class="normal"><a href="#__codelineno-42-4">4</a></span>
<span class="normal"><a href="#__codelineno-42-5">5</a></span>
<span class="normal"><a href="#__codelineno-42-6">6</a></span>
<span class="normal"><a href="#__codelineno-42-7">7</a></span>
<span class="normal"><a href="#__codelineno-42-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1"></a>with matrices as (
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2"></a>  select unnest(v) as m
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3"></a>  from block_matrices_1
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4"></a>  where k = 1)
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5"></a>select
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6"></a>  row_number() over(order by m) as r,
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7"></a>  m
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8"></a>from matrices order by m;
</span></code></pre></div></td></tr></table></div>
<p>返回信息如下：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1">1</a></span>
<span class="normal"><a href="#__codelineno-43-2">2</a></span>
<span class="normal"><a href="#__codelineno-43-3">3</a></span>
<span class="normal"><a href="#__codelineno-43-4">4</a></span>
<span class="normal"><a href="#__codelineno-43-5">5</a></span>
<span class="normal"><a href="#__codelineno-43-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1"></a> r |                 m
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2"></a>---+----------------------------------------------
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3"></a> 1 | {{01,02,03},{04,05,06},{07,08,09}}
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4"></a> 2 | {{10,11,12},{13,14,15},{16,17,18}}
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5"></a> 3 | {{19,20,21},{22,23,24},{25,26,27}}
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6"></a> 4 | {{28,29,30},{31,32,33},{34,35,36}}
</span></code></pre></div></td></tr></table></div>
<p>现在运行unnest：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1">1</a></span>
<span class="normal"><a href="#__codelineno-44-2">2</a></span>
<span class="normal"><a href="#__codelineno-44-3">3</a></span>
<span class="normal"><a href="#__codelineno-44-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1"></a>select unnest(v[2][1]) as val
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2"></a>from block_matrices_1
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3"></a>where k = 1
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4"></a>order by val;
</span></code></pre></div></td></tr></table></div>
<p>返回信息如下：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-45-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-45-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-45-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-45-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-45-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-45-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-45-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-45-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-45-10">10</a></span>
<span class="normal"><a href="#__codelineno-45-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1"></a> val 
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2"></a>-----
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3"></a> 19
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4"></a> 20
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5"></a> 21
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6"></a> 22
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7"></a> 23
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8"></a> 24
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9"></a> 25
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10"></a> 26
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11"></a> 27
</span></code></pre></div></td></tr></table></div>
<p>如果希望按行主顺序查看所有叶值，请使用此查询：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-46-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-46-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-46-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-46-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-46-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-46-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-46-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-46-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-46-10">10</a></span>
<span class="normal"><a href="#__codelineno-46-11">11</a></span>
<span class="normal"><a href="#__codelineno-46-12">12</a></span>
<span class="normal"><a href="#__codelineno-46-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1"></a>with
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2"></a>  matrixes as (
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3"></a>    select unnest(v) as m
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4"></a>    from block_matrices_1
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5"></a>    where k = 1),
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6"></a>  vals as (
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7"></a>    select unnest(m) as val
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8"></a>    from matrixes)
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9"></a>select
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10"></a>  row_number() over(order by val) as r,
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11"></a>  val
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12"></a>from vals
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13"></a>order by 1;
</span></code></pre></div></td></tr></table></div>
<p>返回信息如下：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1">1</a></span>
<span class="normal"><a href="#__codelineno-47-2">2</a></span>
<span class="normal"><a href="#__codelineno-47-3">3</a></span>
<span class="normal"><a href="#__codelineno-47-4">4</a></span>
<span class="normal"><a href="#__codelineno-47-5">5</a></span>
<span class="normal"><a href="#__codelineno-47-6">6</a></span>
<span class="normal"><a href="#__codelineno-47-7">7</a></span>
<span class="normal"><a href="#__codelineno-47-8">8</a></span>
<span class="normal"><a href="#__codelineno-47-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1"></a> r  | val
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2"></a>----+-----
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3"></a>  1 | 01
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4"></a>  2 | 02
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5"></a>  3 | 03
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6"></a> ...
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7"></a> 34 | 34
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8"></a> 35 | 35
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9"></a> 36 | 36
</span></code></pre></div></td></tr></table></div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="PLpgSQL%E4%B8%AD%E7%9A%84%E6%95%B0%E7%BB%84%E5%BE%AA%E7%8E%AF.html" class="md-footer__link md-footer__link--prev" aria-label="上一页: PL/pgSQL中的数组循环">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                PL/pgSQL中的数组循环
              </div>
            </div>
          </a>
        
        
          
          <a href="%E6%95%B0%E7%BB%84%E5%87%BD%E6%95%B0%E5%92%8C%E8%BF%90%E7%AE%97%E7%AC%A6.html" class="md-footer__link md-footer__link--next" aria-label="下一页: 数组函数和运算符">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                数组函数和运算符
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2023 - 2024 贝格迈思（深圳）技术有限公司 粤ICP备17054434号-1
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/as599397086/BMDOC" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.prune", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.aecac24b.min.js"></script>
      
        <script src="../../javascripts/extra.js"></script>
      
    
  </body>
</html>